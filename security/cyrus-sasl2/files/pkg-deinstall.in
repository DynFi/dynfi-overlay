#!/bin/sh

# Created by: hetzels@westbend.net

#set -vx

PKG_BATCH=${BATCH:=NO}
PKG_PREFIX=${PKG_ROOTDIR}/${PKG_PREFIX:=/usr/local}
SASLDB_NAME=%%SASLDB_NAME%%
SASLDB_NAME=${SASLDB_NAME:+${PKG_PREFIX}/etc/%%SASLDB_NAME%%}
SASLDB_PATH=${PKG_PREFIX}/etc/
CYRUS_USER=${CYRUS_USER:=%%CYRUS_USER%%}
CYRUS_GROUP=${CYRUS_GROUP:=%%CYRUS_GROUP%%}

# delete sasldb database
delete_sasldb() {
	if [ -f ${SASLDB_NAME} ] ; then
		result=$(${PKG_PREFIX}/sbin/sasldblistusers2 -f ${SASLDB_PATH}/sasldb2)
		if [ $? -eq 0 -a -z "${result}" ]; then
			rm ${SASLDB_NAME}
			if [ -f ${SASLDB_NAME}-lock ] ; then
				rm ${SASLDB_NAME}-lock
			fi
		else
			echo "WARNING: Users SASL passwords are in ${SASLDB_NAME}, keeping this file"
		fi
	fi
}

case $2 in
	DEINSTALL)
		if [ -n "${SASLDB_NAME}" ]; then
			delete_sasldb
		fi
		;;
esac
